<div class="flex max-h-screen flex-1 space-x-px">
  <div
    class="sidebar shrink-0 {{if this.sidebarIsCollapsed 'collapsed' 'w-72'}}"
  >
    {{#unless @modelIsChanging}}
      {{!
        We teardown and rebuild the sidebar when the model is changing
        so that its state is reset and it inherits the new model's data.
      }}
      {{#if this.profile}}
        <Document::Sidebar
          @profile={{this.profile}}
          @document={{@document}}
          @docType={{@docType}}
          @isCollapsed={{this.sidebarIsCollapsed}}
          @toggleCollapsed={{this.toggleSidebarCollapsedState}}
          @viewerIsGroupApprover={{@viewerIsGroupApprover}}
        />
      {{/if}}
    {{/unless}}
  </div>

  <div class="w-full pt-4 pb-4 pr-4">
    <Hds::Card::Container
      @level="high"
      @hasBorder={{true}}
      @overflow="hidden"
      class="flex h-full items-center justify-center"
    >
      {{#unless @modelIsChanging}}
        {{! Google Workspace: Show iframe }}
        {{#if this.isGoogleWorkspace}}
          {{!
            We teardown and rebuild the iframe when the model is changing
            so that any SRC changes don't add history entries,
            which would cause the back button to break.
          }}
          <iframe
            title="Google Doc"
            height="100%"
            width="100%"
            class="border-0"
            src="https://docs.google.com/document/d/{{@document.objectID}}/edit?embedded=true"
          >
          </iframe>
        {{/if}}

        {{! Local Workspace: Show text editor }}
        {{#if this.isLocalWorkspace}}
          <div class="flex h-full w-full flex-col p-6">
            {{#if this.isEditMode}}
              {{! Edit Mode with Tabs }}
              <div class="mb-4 flex items-center justify-between">
                <h2 class="text-xl font-semibold">Edit Document</h2>
                <div class="flex gap-3">
                  <Hds::Button
                    @text="Cancel"
                    @color="secondary"
                    {{on "click" this.cancelEdit}}
                    disabled={{this.isSavingContent}}
                  />
                  <Hds::Button
                    @text={{if this.isSavingContent "Saving..." "Save"}}
                    @color="primary"
                    {{on "click" this.saveDocumentContent}}
                    disabled={{this.isSavingContent}}
                  />
                </div>
              </div>
              
              {{#if this.isLoadingContent}}
                <div class="flex h-full items-center justify-center">
                  <Hds::ApplicationState
                    @title="Loading document content..."
                  >
                    <:media>
                      <Hds::ApplicationState::Media as |M|>
                        <M.Loader />
                      </Hds::ApplicationState::Media>
                    </:media>
                  </Hds::ApplicationState>
                </div>
              {{else}}
                {{! HDS Tabs for Edit/Preview }}
                <Hds::Tabs @selectedTabIndex={{this.selectedTabIndex}} @onTabChange={{this.handleTabChange}} as |T|>
                  <T.Tab data-test-edit-tab>
                    Edit
                  </T.Tab>
                  <T.Tab data-test-preview-tab>
                    Preview
                  </T.Tab>
                  
                  <T.Panel>
                    {{! Edit Tab - Markdown Editor }}
                    <div class="flex-1 overflow-hidden pt-4">
                      <Hds::Form::Textarea::Field
                        data-test-markdown-editor
                        @value={{this.documentContent}}
                        @isOptional={{false}}
                        @height="400px"
                        @isInvalid={{false}}
                        @extraAriaDescribedBy="edit-helper-text"
                        placeholder="Enter markdown content..."
                        class="font-mono"
                        {{on "input" this.updateContentFromEvent}}
                        disabled={{this.isSavingContent}}
                        as |F|
                      >
                        <F.HelperText id="edit-helper-text">
                          Use Markdown syntax to format your document. Changes are saved when you click Save.
                        </F.HelperText>
                      </Hds::Form::Textarea::Field>
                    </div>
                  </T.Panel>
                  
                  <T.Panel>
                    {{! Preview Tab - Rendered Markdown }}
                    <div class="pt-4">
                      <Hds::Card::Container @level="mid" @hasBorder={{true}} class="min-h-[400px]">
                        <div 
                          data-test-markdown-preview
                          class="prose prose-slate max-w-none p-6"
                        >
                          {{#if this.documentContent}}
                            {{html-safe (markdown-to-html this.documentContent)}}
                          {{else}}
                            <p class="text-gray-500 italic">No content to preview. Switch to Edit tab to add content.</p>
                          {{/if}}
                        </div>
                      </Hds::Card::Container>
                    </div>
                  </T.Panel>
                </Hds::Tabs>
              {{/if}}
            {{else}}
              {{! Read-Only/Preview Mode }}
              <div class="mb-4 flex items-center justify-between">
                <h2 class="text-xl font-semibold">{{@document.title}}</h2>
                <Hds::Button
                  @text="Edit"
                  @color="primary"
                  {{on "click" this.toggleEditMode}}
                />
              </div>
              
              <div class="flex-1 overflow-auto rounded border border-gray-300 bg-white p-6 prose max-w-none">
                {{#if this.documentContent}}
                  {{! Display saved content as rendered markdown }}
                  {{html-safe (markdown-to-html this.documentContent)}}
                {{else}}
                  {{! Placeholder when no content has been loaded yet }}
                  <div class="prose max-w-none">
                    <p class="text-gray-600">
                      Click "Edit" to modify this document's content.
                    </p>
                    <p class="mt-4 text-sm text-gray-500">
                      This document is stored in the local workspace. You can edit it directly in the browser.
                    </p>
                  </div>
                {{/if}}
              </div>
            {{/if}}
          </div>
        {{/if}}
      {{/unless}}
    </Hds::Card::Container>
  </div>

</div>
